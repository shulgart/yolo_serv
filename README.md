# Обнаружение автомобилей на фотографии с помощью модели YOLOv8
![Результат работы сервиса](https://i.imgur.com/xjVfnrB.png)

Простой веб-сервис на `flask`, позволяющий обрабатывать изображения и определять, есть ли на них автомобили или нет. Если есть, выдается информация с помощью рамки на место предполагаемого объекта.
При создании этого проекта очень помог данный [туториал](https://www.freecodecamp.org/news/how-to-detect-objects-in-images-using-yolov8/#detect).
## Модель YOLO
Для детекции используется модель YOLOv8 `best.pt`, которая с помощью fine-tuning дообучена на отдельном датасете. Подробности обучения содержатся в jupyter-notebook `test_task.ipynb`.
Также есть вся информация о тренировке этой модели в архиве `train2.zip`.

## Инструкция к запуску сервиса

Иструкция на английском языке, а также сжатая информация по проекту в целом, содержится в файле `commands.txt` (english instructions -> `commands.txt`).

Для запуска потребуется `Python3` и `pip`.

1. Для начала необходимо установить пакет pipenv для упрощения работы с зависимостями:
```
pip install pipenv
```
2. Далее инициализируем виртуальную оболочку (virtual environment) и устанавливаем все необходимые проекту библиотеки:
```
pipenv install
```
3. Активируем виртуальную оболочку:
```
pipenv shell
```
4. Далее можно выбрать режим работы веб-сервиса - демо или прод:
```
waitress-serve --host=0.0.0.0 --port=8080 object_detector:app
```
или в debug режиме:
```
flask --app object_detector.py --debug run -p 8080
```
5. Чтобы остановить работу сервера введите специальный символ <kbd>Ctrl</kbd> + <kbd>C</kdb>

(сервис не удалось docker'изовать из-за проблемы с зависимостями, а именно с библиотеками CUDA, поэтому приложенный dockerfile пока не является рабочим)

## Функционал сервиса

### Сайт HTML

Сервис развертывает веб-страницу по адресу `http://localhost:8080/`. Чтобы получить доступ к этой веб-странице, введите адрес в адресную строку браузера.
Если все работает правильно, на странице вы увидите кнопку "Выбрать файл". С помощью нее можно выбрать интересующее изображение и загрузить его на сайт. 
После нескольких секунд сервер вернет обработанное моделью изображение и отобразит его на веб-странице. 
Если объекты (автомобили) будут найдены, на исходном изображении появятся красные рамки с их местоположением. 
Если нет - веб-страница просто покажет загруженное изначально изображение без изменений.

Чтобы повторить эту процедуру, снова кликните на кнопку "Выбрать файл".

### API для base64-изображений

Сервис также обладает возможностью принимать в качестве входных данных base64-отформатированные изображения.
Чтобы опробовать данный функционал, используйте файл `send_base64.py`. 
После запуска скрипта этим файлом (н-р, `python send_base64.py` в смежном терминале) на сервер отправится запрос с base64-строкой, содержащей информацию о некотором изображении (которое находится в папке `images`).
Затем сервер, обработав запрос, вернет маску со всеми рамками обнаруженных объектов или пустое изображение, если ничего не было обнаружено, в виде base64-строки.
Запущенный скрипт принимает этот запрос, сохраняет полученную информацию в файл `response_base64.txt`, после чего отображает полученное изображение (набор рамок обнаруженных объектов).

